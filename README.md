# DatLibrarian

[![Stability](https://img.shields.io/badge/stability-experimental-orange.svg?style=flat-square)](https://nodejs.org/api/documentation.html#documentation_stability_index)
[![NPM Version](https://img.shields.io/npm/v/dat-librarian.svg?style=flat-square)](https://www.npmjs.com/package/dat-librarian)
[![JS Standard Style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat-square)](https://github.com/feross/standard)
[![Build Status](https://img.shields.io/travis/garbados/dat-librarian/master.svg?style=flat-square)](https://travis-ci.org/garbados/dat-librarian)
[![Coverage Status](https://img.shields.io/coveralls/github/garbados/dat-librarian/master.svg?style=flat-square)](https://coveralls.io/github/garbados/dat-librarian?branch=master)
[![Greenkeeper badge](https://badges.greenkeeper.io/garbados/dat-librarian.svg)](https://greenkeeper.io/)

A dedicated [Dat](https://datproject.org/) peer. Use DatLibrarian to store and peer many Dat archives. Similar to [hypercore-archiver](https://github.com/mafintosh/hypercore-archiver).

For example:

```javascript
const DatLibrarian = require('dat-librarian')
const librarian = new DatLibrarian({ dir: '.dats' })
console.log(librarian.keys)
> [] // no known archives yet
librarian
  // load pre-existing archives
  .load()
  // promises!
  .then(() => {
    // use keys or links per dat-link-resolve
    return librarian.add('garbados.hashbase.io')
  })
  .then(() => {
    console.log(librarian.keys)
    > ['c33bc8d7c32a6e905905efdbf21efea9ff23b00d1c3ee9aea80092eaba6c4957']
  })
```

## Install

Install DatLibrarian and its dependencies with [npm](https://www.npmjs.com/):

```bash
npm i -S dat-librarian
```

## Usage

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [DatLibrarian](#datlibrarian)
    -   [load](#load)
    -   [get](#get)
    -   [add](#add)
    -   [remove](#remove)
    -   [list](#list)
    -   [keys](#keys)
    -   [close](#close)
    -   [resolve](#resolve)
-   [join](#join)
-   [add](#add-1)
-   [remove](#remove-1)

### 

DatLibrarian is a dedicated [Dat](http://datproject.org/) peer similar to
[hypercore-archiver](https://github.com/mafintosh/hypercore-archiver)
that persists archives to disk and seeds them to the network.

**Examples**

```javascript
const DatLibrarian = require('dat-librarian')
const librarian = new DatLibrarian({ dir: '.dats' })
librarian
  // load pre-existing archives
  .load()
  // promises!
  .then(() => {
    // use keys or links per dat-link-resolve
    return librarian.add('garbados.hashbase.io')
  })
```

### DatLibrarian

**Extends EventEmitter**

Instantiate a new DatLibriarian.

**Parameters**

-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options object.
    -   `options.dir` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The librarian's working directory, where it will cache archives. Required.
    -   `options.dat` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options object passed to Dat()
    -   `options.net` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options object passed to dat.joinNetwork()

#### load

Load Dat archives into cache by checking the working
directory for existing archives.

**Examples**

```javascript
librarian.load().then(() => {
  ...
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** A promise that resolves once any existing archives have been loaded into the cache.

#### get

Get an archive from the cache by link.

**Parameters**

-   `link` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** Link to a Dat archive.

**Examples**

```javascript
librarian.get('garbados.hashbase.io').then((dat) => {
  ...
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Dat>** Promise that resolves to a Dat archive.

#### add

Add an archive by link. Automatically joins the network
and begins downloading, but does not wait for the archive
to complete.

**Parameters**

-   `link` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** Link to a Dat archive.

**Examples**

```javascript
librarian.add('garbados.hashbase.io').then((dat) => {
  ...
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** A promise that resolves once the archive has been added to the cache.

#### remove

Remove an archive from the cache and the working directory.

**Parameters**

-   `link` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** Link to a Dat archive.

**Examples**

```javascript
librarian.remove('garbados.hashbase.io').then(() => {
  ...
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** A promise that resolves once the archive has been removed.

#### list

Lists the keys in the cache.

**Examples**

```javascript
let keys = librarian.list()
console.log(keys)
> ['c33bc8d7c32a6e905905efdbf21efea9ff23b00d1c3ee9aea80092eaba6c4957']
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** An array of all the keys in the cache.

#### keys

Getter for the keys in the cache. Alias to #list()

**Examples**

```javascript
console.log(librarian.keys)
> ['c33bc8d7c32a6e905905efdbf21efea9ff23b00d1c3ee9aea80092eaba6c4957']
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** An array of all the keys in the cache.

#### close

Close the librarian and any archives it is peering.

**Examples**

```javascript
librarian.close().then(() => {
  ...
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Promise that resolves once all archives have closed.

#### resolve

Promification of dat-link-resolve
for convenience's sake.

**Parameters**

-   `link` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** Link to a Dat archive

**Examples**

```javascript
DatLibrarian.resolve('garbados.hashbase.io').then((key) => {
  console.log(key)
  > 'c33bc8d7c32a6e905905efdbf21efea9ff23b00d1c3ee9aea80092eaba6c4957'
})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Buffer](https://nodejs.org/api/buffer.html)>** Key of that Dat archive

### join

Event emitted once an archive has
completed its first round of peer discovery.

**Examples**

```javascript
librarian.on('join', (dat) => {
  ...
})
```

### add

Event emitted when an archive is added.

**Examples**

```javascript
librarian.on('add', (dat) => {
  ...
})
```

### remove

Event emitted once an archive has been removed.

**Examples**

```javascript
librarian.on('remove', (link) => {
  ...
})
```

## Development

Download the source and run the test suite:

    git clone garbados/dat-librarian
    cd dat-librarian
    npm install
    npm test

## Contributions

All contributions are welcome: bug reports, feature requests, "why doesn't this work" questions, patches for fixes and features, etc. For all of the above, [file an issue](https://github.com/garbados/dat-librarian/issues) or [submit a pull request](https://github.com/garbados/dat-librarian/pulls).

## License

[Apache-2.0](https://www.apache.org/licenses/LICENSE-2.0)
